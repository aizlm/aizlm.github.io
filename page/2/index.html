<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="为了兴趣而学"><meta name="keywords" content=""><meta name="author" content="Aizlm"><meta name="copyright" content="Aizlm"><title>瞎学日记 | Aizlm‘s_Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '6.1.0'
} </script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="Aizlm‘s_Blog" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Aizlm</div><div class="author-info__description text-center">为了兴趣而学</div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">26</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">14</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Aizlm‘s_Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Aizlm‘s_Blog</div><div id="site-sub-title">瞎学日记</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2022/05/07/flink%E5%AD%A6%E4%B9%A0/">flink学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-05-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/web%E5%AD%A6%E4%B9%A0%E6%8D%8F/">web学习捏</a></span><div class="content"><h1 id="flink学习"><a href="#flink学习" class="headerlink" title="flink学习"></a>flink学习</h1><ul>
<li>特点<ul>
<li>低延迟</li>
<li>高吞吐</li>
<li>准确率高、容错率小</li>
</ul>
</li>
<li>需要处理的问题<ul>
<li>集群环境下，如何正确访问数据进行处理？</li>
<li>集群环境下，数据处理错误，如何进行回滚到初始状态进行正确处理分析数据？</li>
</ul>
</li>
</ul>
<h2 id="flink-amp-WordCount"><a href="#flink-amp-WordCount" class="headerlink" title="flink &amp; WordCount"></a>flink &amp; WordCount</h2><h3 id="Batch（弃用DataSet）"><a href="#Batch（弃用DataSet）" class="headerlink" title="Batch（弃用DataSet）"></a>Batch（弃用DataSet）</h3><ul>
<li>目录结构</li>
</ul>
<img src="/2022/05/07/flink%E5%AD%A6%E4%B9%A0/image-20220507095140469.png">

<ul>
<li>批处理代码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 创建环境</span></span><br><span class="line"><span class="type">ExecutionEnvironment</span> <span class="variable">env</span> <span class="operator">=</span> ExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 读取数据</span></span><br><span class="line">DataSource&lt;String&gt; wordDataSource = env.readTextFile(<span class="string">&quot;input/words.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 将每行数据进行分词，转换成二元组</span></span><br><span class="line">FlatMapOperator&lt;String, Tuple2&lt;String, Long&gt;&gt; wordAndOneTuple = wordDataSource.flatMap((String line, Collector&lt;Tuple2&lt;String, Long&gt;&gt; out) -&gt; &#123;</span><br><span class="line">    <span class="comment">// 3.1 将一行数据进行分词</span></span><br><span class="line">    String[] words = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="comment">// 3.2 将单词转换成二元组</span></span><br><span class="line">    <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">        out.collect(Tuple2.of(word, <span class="number">1L</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).returns(Types.TUPLE(Types.STRING, Types.LONG));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 根据元组word进行分组</span></span><br><span class="line">UnsortedGrouping&lt;Tuple2&lt;String, Long&gt;&gt; wordAndOneGroup = wordAndOneTuple.groupBy(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. 分组后累积单词数</span></span><br><span class="line">AggregateOperator&lt;Tuple2&lt;String, Long&gt;&gt; sum = wordAndOneGroup.sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">sum.print();</span><br></pre></td></tr></table></figure>

<ul>
<li>结果</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(java,1)</span><br><span class="line">(flink,1)</span><br><span class="line">(world,1)</span><br><span class="line">(hello,3)</span><br></pre></td></tr></table></figure>



<h3 id="Stream"><a href="#Stream" class="headerlink" title="Stream"></a>Stream</h3><ul>
<li>有界流处理</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StreamExecutionEnvironment</span> <span class="variable">env</span> <span class="operator">=</span> StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">DataStreamSource&lt;String&gt; wordDataStreamSource = env.readTextFile(<span class="string">&quot;input/words.txt&quot;</span>);</span><br><span class="line">SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; wordAndOneTuple = wordDataStreamSource.flatMap((String line, Collector&lt;Tuple2&lt;String, Long&gt;&gt; out) -&gt; &#123;</span><br><span class="line">    String[] words = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String word : words) &#123;</span><br><span class="line">        out.collect(Tuple2.of(word, <span class="number">1L</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).returns(Types.TUPLE(Types.STRING, Types.LONG));</span><br><span class="line">KeyedStream&lt;Tuple2&lt;String, Long&gt;, String&gt; wordAndOneKeyedStream = wordAndOneTuple.keyBy(data -&gt; data.f0);</span><br><span class="line">SingleOutputStreamOperator&lt;Tuple2&lt;String, Long&gt;&gt; sum = wordAndOneKeyedStream.sum(<span class="number">1</span>);</span><br><span class="line">sum.print();</span><br><span class="line"><span class="comment">// 流处理会不断等待输入流，启动执行</span></span><br><span class="line">env.execute();</span><br></pre></td></tr></table></figure>

<ul>
<li>结果</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1&gt; (java,1)</span><br><span class="line">2&gt; (hello,1)</span><br><span class="line">3&gt; (world,1)</span><br><span class="line">2&gt; (hello,2)</span><br><span class="line">4&gt; (flink,1)</span><br><span class="line">2&gt; (hello,3)</span><br></pre></td></tr></table></figure>

</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/05/05/jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/">jenkins自动部署</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-05-05</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0%E6%8D%8F/">后端学习捏</a></span><div class="content">Here's something encrypted, password is required to continue reading.</div><a class="more" href="/2022/05/05/jenkins%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">ES使用（无原理）</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-27</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0%E6%8D%8F/">后端学习捏</a></span><div class="content"><h1 id="ELK"><a href="#ELK" class="headerlink" title="ELK"></a>ELK</h1><h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><p>文档型数据库，非关系型数据库结构：</p>
<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/146a779da01f53e7f7a8d53132d3c7cf.png">

<p>倒序排序：</p>
<p>将原本通过ID查询的内容，进行分词操作，映射到相应的id中。</p>
<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427084342277.png">



<h2 id="如何使用？"><a href="#如何使用？" class="headerlink" title="如何使用？"></a>如何使用？</h2><ul>
<li>访问地址见项目README；</li>
</ul>
<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427094347169.png">

<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427095722738.png">

<p>chain-dev-*为索引，类似于关系型数据库中为DataBase，索引名字在logstash中定义，具体可见README_ELK；<br>可用字段为收集到的日志所对应的标签值，常用搜索的标签为：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;_index&quot;</span><span class="punctuation">:</span> <span class="string">&quot;chain-dev-2022.04.27&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;_doc&quot;</span><span class="punctuation">,</span>	<span class="comment">// 文档，可认为是收集到的数据</span></span><br><span class="line">  <span class="attr">&quot;_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;q52paIABsSUfygaQAH36&quot;</span><span class="punctuation">,</span>	<span class="comment">// 由ES随机生成</span></span><br><span class="line">  <span class="attr">&quot;_score&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;_source&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>	<span class="comment">// 收集的数据</span></span><br><span class="line">    <span class="attr">&quot;@timestamp&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2022-04-27T01:35:47.849Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;231ms&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;host&quot;</span><span class="punctuation">:</span> <span class="string">&quot;localhost&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;thread_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http-nio-10000-exec-4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;logger_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;cn.jnu.web.base.LogAspect&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="string">&quot;INFO&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;traceId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;a6a9eb6b47a98d75&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;spanId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;8a68f9e630edd054&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;port&quot;</span><span class="punctuation">:</span> <span class="number">48268</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;@version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;springAppName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;service-auth&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;level_value&quot;</span><span class="punctuation">:</span> <span class="number">20000</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  ...</span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@timestamp：时间，可通过console范围搜索</li>
<li>host：ip</li>
<li>logger_name：全类名</li>
<li>springAppName：微服务名称</li>
<li>traceId：链路追踪，全链路查询日志时使用<ul>
<li>通过页面响应头有个RequestId进行查询ELK中的traceId</li>
</ul>
</li>
</ul>
<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427100448369.png">

<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427100615257.png">



<h3 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h3><p>两种方式：</p>
<ul>
<li>第一种：直接使用Kibana查询语言KQL进行查询</li>
</ul>
<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427102012936.png">



<ul>
<li>第二种：通过console传输json，可以进行聚类、模糊等查询</li>
</ul>
<p>console：</p>
<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427084444128.png">



<h2 id="以表UI形式显示"><a href="#以表UI形式显示" class="headerlink" title="以表UI形式显示"></a>以表UI形式显示</h2><img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/29150985243f4b28c37c7bdcfe4af95.png">

<img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/8f92455ef35dc64f5e89cef8af59e99.png">



<h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><ul>
<li><p>集群的概念及作用：详见【2】29</p>
<ul>
<li>一个集群就是由一个或多个服务器节点组织在一起，共同持有整个的数据，并一起提供索引和搜索功能。</li>
<li>单台 Elasticsearch 服务器提供服务，往往都有最大的负载能力，超过这个阈值，服务器性能就会大大降低甚至不可用，所以生产环境中，一般都是运行在指定服务器集群中。</li>
</ul>
</li>
<li><p>数据分片及副本：详见【2】33</p>
<ul>
<li>原因：一个索引可以存储超出单个节点硬件限制的大量数据。比如，一个具有 10 亿文档数据的索引占据1TB 的磁盘空间，而任一节点都可能没有这样大的磁盘空间。 或者单个节点处理搜索请求，响应太慢。</li>
<li>集群有新节点加入时，ES帮助我们直接进行分片控制。</li>
</ul>
</li>
</ul>
<h2 id="查询原理"><a href="#查询原理" class="headerlink" title="查询原理"></a>查询原理</h2><img src="/2022/04/27/ES%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20220427102333654.png">

<ul>
<li>路由计算：详见【2】39</li>
</ul>
<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>【1】ELK查看DSL：<a target="_blank" rel="noopener" href="https://blog.csdn.net/JSWANGCHANG/article/details/121356812">https://blog.csdn.net/JSWANGCHANG/article/details/121356812</a></p>
<p>【2】ES完整笔记：<a target="_blank" rel="noopener" href="https://blog.csdn.net/u011863024/article/details/115721328">https://blog.csdn.net/u011863024/article/details/115721328</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;traceId&quot;: &quot;a6a9eb6b47a98d75&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;from&quot;: 0,</span><br><span class="line">  &quot;size&quot;: 10,</span><br><span class="line">  &quot;sort&quot;:&#123;</span><br><span class="line">		&quot;@timestamp&quot;:&#123;</span><br><span class="line">			&quot;order&quot;:&quot;desc&quot;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>













</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/19/mybatis%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0/">mybatis简单学习</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-19</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/%E5%90%8E%E7%AB%AF%E5%AD%A6%E4%B9%A0%E6%8D%8F/">后端学习捏</a></span><div class="content"><h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><ul>
<li><p>为啥要用工厂模式捏？：<a target="_blank" rel="noopener" href="https://baijiahao.baidu.com/s?id=1705504841108391352&amp;wfr=spider&amp;for=pc">https://baijiahao.baidu.com/s?id=1705504841108391352&amp;wfr=spider&amp;for=pc</a></p>
</li>
<li><p>尚硅谷mybatis：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_19387933/article/details/123256034">https://blog.csdn.net/qq_19387933/article/details/123256034</a></p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/13/%E5%8C%BA%E5%9D%97%E9%93%BE%E8%AE%A4%E7%9F%A5/">区块链认知</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-13</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">区块链</a></span><div class="content">Here's something encrypted, password is required to continue reading.</div><a class="more" href="/2022/04/13/%E5%8C%BA%E5%9D%97%E9%93%BE%E8%AE%A4%E7%9F%A5/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/11/Android%E8%99%9A%E6%8B%9F%E5%8C%96-%E5%AE%B9%E5%99%A8/">Android虚拟化&amp;容器</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-11</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Android%E9%80%86%E5%90%91%E7%9F%A5%E8%AF%86/">Android逆向知识</a></span><div class="content"><h1 id="Android虚拟化"><a href="#Android虚拟化" class="headerlink" title="Android虚拟化"></a>Android虚拟化</h1><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/10/2021KCTF4%E5%81%B6%E9%81%87%E6%A3%8B%E7%97%B4/">2021KCTF4偶遇棋痴</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-10</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/%E6%9C%89%E7%A9%BA%E6%9D%A5%E4%B8%80%E9%81%93/">有空来一道</a></span><div class="content"><h1 id="第四题-偶遇棋痴"><a href="#第四题-偶遇棋痴" class="headerlink" title="第四题 偶遇棋痴"></a>第四题 偶遇棋痴</h1><ul>
<li>Java层：</li>
</ul>
<img src="/2022/04/10/2021KCTF4%E5%81%B6%E9%81%87%E6%A3%8B%E7%97%B4/image-20220410220304084.png">

<ul>
<li>native静态分析：静态注册</li>
</ul>
<img src="/2022/04/10/2021KCTF4%E5%81%B6%E9%81%87%E6%A3%8B%E7%97%B4/image-20220410220342932.png">

<p>目标是返回1，所以需要到LABEL_11得到v3&#x3D;1然后return掉。</p>
<img src="/2022/04/10/2021KCTF4%E5%81%B6%E9%81%87%E6%A3%8B%E7%97%B4/image-20220410220538797.png">

<p>输入字符位数14，然后到第二个箭头时，v5是30，获取一下v15，再看v15经过sub_39614()变成了什么，最后到LABEL_11。</p>
<img src="/2022/04/10/2021KCTF4%E5%81%B6%E9%81%87%E6%A3%8B%E7%97%B4/image-20220410220838527.png">













<h1 id="IDA函数映射"><a href="#IDA函数映射" class="headerlink" title="IDA函数映射"></a>IDA函数映射</h1><ul>
<li>_aeabi_memclr8：memset</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/10/%E4%BB%8E0%E5%BC%80%E5%A7%8B%EF%BC%81/">从0开始！</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-10</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Android%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91/">Android应用开发</a></span><div class="content"><h1 id="重新学习Android应用开发"><a href="#重新学习Android应用开发" class="headerlink" title="重新学习Android应用开发"></a>重新学习Android应用开发</h1><p>写着一篇主要是发现了自己虽然能理解流程，但很慢且不能看到流程马上想到如何实现，这不好，所以重新开始。主要记录开发中学习到的新的知识点，干巴爹！</p>
<ul>
<li>问题：xml布局文件的内容如何转变为View对象？</li>
</ul>
<p>aapt（Android Asset Packaging Tool）将布局文件资源编译压缩紧凑后，打包到.apk文件中。</p>
<p>Activity的子类的onCreate(Bundle)方法调用setContentView(…)方法时， Activity的子类使用LayoutInflater类实例化布局文件中定义的每一个View对象。</p>
<img src="/2022/04/10/%E4%BB%8E0%E5%BC%80%E5%A7%8B%EF%BC%81/image-20220408212807086.png">

<p>利用ClassLoader加载实例，ClassLoader中的双亲委派机制也很重要！</p>
<ul>
<li>Activity生命周期以及对应内存、用户可见、前台关系？</li>
</ul>
<img src="/2022/04/10/%E4%BB%8E0%E5%BC%80%E5%A7%8B%EF%BC%81/image-20220409161849607.png">

<img src="/2022/04/10/%E4%BB%8E0%E5%BC%80%E5%A7%8B%EF%BC%81/image-20220409161928532.png">



<ul>
<li>问题：如何在app下一次启动时，还原到上一次的状态？</li>
</ul>
<p>例如：旋转时，app会先销毁实例，走完一个Activity的生命周期，再调用Activity的onCreate、onStart、onResume方法，将app的当前Activity显示到前台中。</p>
<p>解决方案：重写onSaveInstanceState(Bundle outState)函数，将需要保存的状态以bundle的形式写入到outState中，在onCreate(Bundle savedInstanceState)下次调用的时候，从中取相应数据。</p>
<p>但需要注意的是这种方法，在完全退出时，调用的onDestory()销毁掉实例时，不会保存outState Bundle，因为Activity实例已经不存在于内存当中了。</p>
<img src="/2022/04/10/%E4%BB%8E0%E5%BC%80%E5%A7%8B%EF%BC%81/image-20220410135836647.png">

<p>实例暂存态（onStop()处理永久性数据，onSaveInstanceState处理暂存态数据）：在彻底销毁和重启系统时，暂存态数据会被清除。</p>
<img src="/2022/04/10/%E4%BB%8E0%E5%BC%80%E5%A7%8B%EF%BC%81/image-20220410144259030.png">







<h1 id="Github上传代码"><a href="#Github上传代码" class="headerlink" title="Github上传代码"></a>Github上传代码</h1><ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv10612248/">https://www.bilibili.com/read/cv10612248/</a></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/">看雪CM3</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-07</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/%E6%9C%89%E7%A9%BA%E6%9D%A5%E4%B8%80%E9%81%93/">有空来一道</a></span><div class="content"><h1 id="看雪CM3"><a href="#看雪CM3" class="headerlink" title="看雪CM3"></a>看雪CM3</h1><p>运行之后发现是个简单输入验证码界面。</p>
<ul>
<li>Java层静态分析：xml中application没有debuggable选项，有backup可能会诱发漏洞点。</li>
</ul>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328103138716.png">

<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328103334441.png">

<ul>
<li>so层静态分析：在导出函数中没有找到静态注册的函数名，进JNI_OnLoad中进行分析，一开始忽略了反调试，j_AD()为反调试函数，这里的反调试只是检测进程是否被附加调试进程。</li>
</ul>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328103612257.png">

<p>j_AD()：</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328103850827.png">

<ul>
<li>so层动态分析：需要在so加载时进行截断，绕过反调试函数。</li>
</ul>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328110339719.png">

<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328115316040.png">

<p>定位到RegisterNatives处，发现参数可以跳转到另一个地址，根据RegisterNative参数JNINativeMethod一一对应上。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">jint</span> (*RegisterNatives)(JNIEnv*, jclass, <span class="type">const</span> JNINativeMethod*, jint);</span><br></pre></td></tr></table></figure>

<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328122115020.png">

<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328122450998.png">

<p>函数名：</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328122640761.png">

<p>签名：</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328122759864.png">

<p>地址：</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220328123029740.png">

<ul>
<li>动态分析找到对应函数，定位到bc函数：</li>
</ul>
<p>执行一下任意字符，然后发现出现 Password Error~ 字样，没有经过j_dc函数，说明是由j_wolf_de和j_st其中一个进行显示的。</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220407221122867.png">

<p>j_dc涉及到的参数都是环境和系统上下文，没必要看。</p>
<p>进入j_jk看到一样的j_wolf_de与j_st，重点在j_dc里面，需要返回的result是1，进入分析发现，最终到ds函数：需要返回1，则v8&#x3D;1，这里的v3与v4通过sub_15184进行转换，v4又由j_wolf_de得到，则去hook相应的j_wolf_de方法，获取得到v4。</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220407223939145.png">

<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220407224145304.png">

<p>hook代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Script loaded successfully &quot;</span>);</span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> wolf_de_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libwolf.so&quot;</span>, <span class="string">&quot;_Z7wolf_dePKc&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;wolf_de_addr:&quot;</span>+wolf_de_addr);</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(wolf_de_addr, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> env = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">tryGetEnv</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;***orgin: &quot;</span> + args[<span class="number">0</span>].<span class="title function_">readCString</span>());</span><br><span class="line">            <span class="keyword">var</span> key = env.<span class="title function_">newStringUtf</span>(<span class="string">&quot;636D55B2AA8609CB&quot;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;***trueKey: &quot;</span> + key);</span><br><span class="line">            <span class="keyword">var</span> truechr = env.<span class="title function_">getStringUtfChars</span>(key, <span class="number">0</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;***trueJstring: &quot;</span> + truechr.<span class="title function_">readCString</span>());</span><br><span class="line">            args[<span class="number">0</span>] = truechr;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;***changeJstring: &quot;</span> + args[<span class="number">0</span>].<span class="title function_">readCString</span>());</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;***return: &quot;</span> + retval.<span class="title function_">readCString</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220407221053077.png">



<h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>【1】静态反调试：<a target="_blank" rel="noopener" href="http://www.zhaoxiaodan.com/java/android/android-native%E5%8F%8D%E8%B0%83%E8%AF%95.html">http://www.zhaoxiaodan.com/java/android/android-native%E5%8F%8D%E8%B0%83%E8%AF%95.html</a></p>
<p>【2】动态注册：<a target="_blank" rel="noopener" href="https://blog.csdn.net/leifengpeng/article/details/52447864">https://blog.csdn.net/leifengpeng/article/details/52447864</a></p>
<h1 id="hook注意事项"><a href="#hook注意事项" class="headerlink" title="hook注意事项"></a>hook注意事项</h1><ul>
<li>如何获取native需要hook的函数名</li>
</ul>
<p>frida：Module.enumerateExports(“libwolf.so”)</p>
<img src="/2022/04/07/%E7%9C%8B%E9%9B%AACM3/image-20220407225503552.png"></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/04/03/%E5%8A%A0%E5%9B%BA%E7%9A%84%E4%BA%86%E8%A7%A3/">加固的了解</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-04-03</time><span class="article-meta tags"><span class="article-meta__separator">|</span><i class="fa fa-tag article-meta__icon" aria-hidden="true"></i><a class="article-meta__tags" href="/tags/Android%E9%80%86%E5%90%91%E7%9F%A5%E8%AF%86/">Android逆向知识</a></span><div class="content"><h1 id="Android加固认知"><a href="#Android加固认知" class="headerlink" title="Android加固认知"></a>Android加固认知</h1><h1 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h1><p>【1】入门级加固：<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-255220.htm?source=1">https://bbs.pediy.com/thread-255220.htm?source=1</a></p>
<p>【2】ClassLoader：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/renhui/articles/14268203.html">https://www.cnblogs.com/renhui/articles/14268203.html</a></p>
<p>【3】（未看）ClassLoader：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/81293598">https://zhuanlan.zhihu.com/p/81293598</a></p>
<ul>
<li>【4】动态加载系列<ul>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/fb03c2b59241">https://www.jianshu.com/p/fb03c2b59241</a></li>
</ul>
</li>
</ul>
<p>【5】shuwoom大佬的加固理解与实现：<a target="_blank" rel="noopener" href="https://shuwoom.com/?p=360#1014_Dex%E6%95%B4%E4%BD%93%E5%8A%A0%E5%9B%BA%E5%8E%9F%E7%90%86">https://shuwoom.com/?p=360#1014_Dex%E6%95%B4%E4%BD%93%E5%8A%A0%E5%9B%BA%E5%8E%9F%E7%90%86</a></p>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2022 By Aizlm</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/lib/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>