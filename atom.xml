<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Aizlm‘s_Blog</title>
  
  <subtitle>瞎学日记</subtitle>
  <link href="https://aizlm.github.io/atom.xml" rel="self"/>
  
  <link href="https://aizlm.github.io/"/>
  <updated>2022-03-18T08:39:01.102Z</updated>
  <id>https://aizlm.github.io/</id>
  
  <author>
    <name>Aizlm</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>权限漏洞分析</title>
    <link href="https://aizlm.github.io/2022/03/18/%E6%9D%83%E9%99%90%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>https://aizlm.github.io/2022/03/18/%E6%9D%83%E9%99%90%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2022-03-18T07:39:37.000Z</published>
    <updated>2022-03-18T08:39:01.102Z</updated>
    
    <content type="html"><![CDATA[<h2 id="【复现】Permission漏洞"><a href="#【复现】Permission漏洞" class="headerlink" title="【复现】Permission漏洞"></a>【复现】Permission漏洞</h2><h2 id="Permission基础"><a href="#Permission基础" class="headerlink" title="Permission基础"></a>Permission基础</h2><p>权限：</p><p>权限都需要在manifest中进行声明，危险权限需要在请求时进行验证。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">manifest</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">(1)name：自定义权限的名字，其他app引用的名字</span></span><br><span class="line"><span class="comment">(2)lable：标签，用于描述该权限保护的关键功能,显示给用户的，它的值可是一个 string 数据</span></span><br><span class="line"><span class="comment">(3)description：描述，比 label 更长的对权限的描述。值是通过resource文件中获取的，不能直接写string值。</span></span><br><span class="line"><span class="comment">(4)permissionGroup：权限组，可选属性。在大多数情况下，应该将其设置为一个标准系统组（android.Manifest.permission_group），尽管可以自己定义一个组。</span></span><br><span class="line"><span class="comment">(5)protectionLevel：权限的等级，必须的属性 </span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">permission</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">android:name</span>=<span class="string">&quot;com.example.myapp.permission.DEADLY_ACTIVITY&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:label</span>=<span class="string">&quot;@string/permlab_deadlyActivity&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:description</span>=<span class="string">&quot;@string/permdesc_deadlyActivity&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:permissionGroup</span>=<span class="string">&quot;android.permission-group.COST_MONEY&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">android:protectionLevel</span>=<span class="string">&quot;dangerous&quot;</span></span></span><br><span class="line"><span class="tag">            /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">manifest</span>&gt;</span></span><br></pre></td></tr></table></figure><p>危险权限组：</p><img src="..\权限漏洞分析\image-20220318154535112.png" alt="image-20220318154535112" style="zoom:50%;" /><ul><li><p>安装时权限：安装时所需要提供的权限，<strong>Android6.0</strong>后不需要赋予危险权限。</p></li><li><p>运行时权限：用户使用有关危险权限时的功能时，需要请求响应权限。</p><ul><li><p>关于危险权限的权限组</p><ul><li>对应Android6-8，用户赋予权限组的任意一个权限，则app会获取到权限组的所有权限。</li><li>Android9后，用户赋予权限组的一个权限，则app只能获取到权限组该权限。</li></ul></li><li><p>申请权限步骤</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">权限申请步骤：</span><br><span class="line"><span class="number">1.</span>检查有无权限 （ContextCompat.checkSelfPermission()）</span><br><span class="line">    有权限——&gt;运行</span><br><span class="line">    无权限——&gt;申请权限</span><br><span class="line"><span class="keyword">if</span> (ContextCompat.checkSelfPermission(thisActivity, Manifest.permission.WRITE_CALENDAR)!= PackageManager.PERMISSION_GRANTED) &#123;</span><br><span class="line">        <span class="comment">// 权限没有被授予</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="number">2.</span>申请权限（走权限回调）</span><br><span class="line">    用户同意——&gt;运行</span><br><span class="line">    用户拒绝——&gt;展示跳转设置界面对话框</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">requestPermissions()弹窗让用户选择是否授权，选择后进入Activity的回调函数onRequestPermissionsResult，这里的权限都需要在manifest中进行声明，否则不会有弹窗</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ActivityCompat.requestPermissions(thisActivity,<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;Manifest.permission.READ_CONTACTS&#125;,<span class="number">1</span>);</span><br><span class="line"> </span><br><span class="line"><span class="number">3.</span>跳转设置对话框</span><br><span class="line">    同意跳转——&gt;跳转特定的权限打开界面</span><br><span class="line">    用户拒绝——&gt;Toast提示没权限，功能不能正常使用</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onRequestPermissionsResult</span><span class="params">(<span class="type">int</span> requestCode, <span class="meta">@NonNull</span> String[] permissions, <span class="meta">@NonNull</span> <span class="type">int</span>[] grantResults)</span>;</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><img src="/..%5C%E6%9D%83%E9%99%90%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%5Cimage-20220318154424251.png" alt="image-20220318154424251"></p><ul><li>特殊权限：只有平台和OEM（原始设备制造商）可以定义，用于执行特定操作，level被分配为protect。</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;【复现】Permission漏洞&quot;&gt;&lt;a href=&quot;#【复现】Permission漏洞&quot; class=&quot;headerlink&quot; title=&quot;【复现】Permission漏洞&quot;&gt;&lt;/a&gt;【复现】Permission漏洞&lt;/h2&gt;&lt;h2 id=&quot;Permissio</summary>
      
    
    
    
    
    <category term="安卓漏洞" scheme="https://aizlm.github.io/tags/%E5%AE%89%E5%8D%93%E6%BC%8F%E6%B4%9E/"/>
    
  </entry>
  
</feed>
